<!-- https://www.ombulabs.com/blog/learning/rails/nested-forms.html -->
<!-- https://dev.to/pezza/dynamic-nested-forms-with-turbo-3786 -->
<% css_form_label = "inline-block align-middle text-sm font-medium leading-6" %>
<% css_form_text_field = "block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" %>
<section class="w-full">
  <div class="h-auto">
    <div class="max-w-full max-h-full">
      <div data-controller="reveal" data-reveal-hidden-class="hidden" class="block w-full">
        <div data-action="click->reveal#toggle" class="w-full">
          <button type="button" class="w-full text-center rounded-md bg-indigo-50 px-3 py-2 text-sm font-semibold text-indigo-600 shadow-sm hover:bg-indigo-100 active:bg-indigo-200 focus:bg-indigo-100 focus:outline-none">Partially deliver order</button>
        </div>
        <div data-reveal-target="item" class="hidden">
          <div class="h-full w-full rounded-md bg-slate-50">
            <div class="p-3">
              <div class="my-3">
                <h3 class="text-base font-semibold leading-6 text-gray-700">Partial Order Delivery</h3>
                <p class="mt-1 text-sm text-gray-500">Deliver individual order contents</p>
              </div>
              <div class="m-auto grid grid-cols-1 gap-y-5 gap-x-3">
                <%#= form.fields_for :order_content do |order_content_form| %>
                <%= form.fields_for :order_content, order.order_content do |order_content_form| %>
                  <% content = order_content_form.object %>
                  <div class="block">
                    <% content.package_types.each do |package_type| %>
                      <% if content.has_package_type_amount?(package_type) %>
                        <div class="mx-auto flex justify-between space-y-3 space-x-1 text-center">
                          <div class="justify-self-start self-center">
                            <div class="h-full">
                              <%= order_content_form.label package_type, package_type.to_s.pluralize.capitalize, class: "mt-3 inline-block align-baseline text-sm text-gray-400 font-medium leading-6" %>
                            </div>
                          </div>
                          <%#= content_tag :span, "#{content.cast_package_amount_to_i! package_type}"%>
                          <%#= content_tag :span, "#{(content.send package_type)}" %>
                          <% if content.has_castable_package_amount? package_type %>
                            <div class="grow">
                              <%= order_content_form.number_field package_type, min: 0, max: (content.cast_package_amount_to_i! package_type), data: { controller: "number-field-input", action: "number-field-input#rejectLetters"}, id: "partially_deliver_#{package_type}", class: 'w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6' %>
                            </div>
                            <div class="justify-self-end self-center rounded-md border-0 p-1.5 bg-white text-slate-500 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 sm:text-sm sm:leading-6">
                              <span class="text-sm text-gray-400 font-medium leading-6">was: </span>
                              <%= content_tag :span, "#{(content.send package_type)}" %>
                            </div>
                          <% else %>
                            <div class="grow self-center rounded-md border-0 p-1.5 bg-white text-slate-500 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 sm:text-sm sm:leading-6">
                              <div class="shrink max-w-full">
                                <%= content_tag :span, "Remove text from \"#{package_type.to_s.capitalize.pluralize}\" field above for partial delivery", class:"text-sm text-gray-800 font-medium leading-6" %>
                              </div>
                            </div>
                          <% end %>
                        </div>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
            <!-- <div class="inline-block w-full">
              <div class="m-3">
                <p class="m-1 text-xs text-gray-500">*This will not archive the order.</p>
                <button type="button" class="w-full rounded-md bg-white px-3 py-2 text-sm font-medium text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">Deliver</button>
              </div>
            </div> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
